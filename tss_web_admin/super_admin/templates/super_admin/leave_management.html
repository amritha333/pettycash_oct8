{% extends "super_admin/menu.html" %}

{% load static %}
{% load entitle_balance %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<div class="content ">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="box_header">
                    <div class="row">
                        <div class="col-md-7 col-12">
                            <div class="mainiconbox"><i class="fa fa-user"></i>
                            </div>
                            <h4 class="m-t-0 header-title">
                                <div class="breadcrumbs ng-scope">
                                    <ul>
                                        <li><a href="admin_dashboard">Home</a></li>
                                        <li><a>Leave Management </a></li>
                                        <!-- <li><a>User  Settings</a></li> -->
                                    </ul>
                                    <!-- <div>Leave </div> -->
                                </div>
                            </h4>
                        </div>
                        <div class="col-md-5 col-12">
                            <div class="pull-right p-t-10">

                                <a data-toggle="modal" class="btn btn-info newbtn_crete" data-target="#newuser"> <i class="mdi mdi-plus-circle-outline"></i> APPLY NEW LEAVE
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% if draf_leave_details %}
             <div class="card" style="       box-shadow: -2px -1px -1px rgb(0 0 0 / 30%);
             padding: 1em;
             border: 1px solid rgba(0,0,0,0.15);
             display: grid;
             gap: 1em;
             background: #fafafa;">
                <br>
                              
                <table id="example5" class="table table-hover responsive nowrap table-bordered" style="width:100%">
                    <thead>
                      <tr>
                        <th>Employee Name</th>
                        <th>Leave Type</th>
                        <th>From Date</th>
                        <th>To Date</th>
                        <th>Total Days</th>
                        <th>Created At</th>
                        <th>Absence Status</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                        {% for i in draf_leave_details %}
                      <tr>
                        <td>
                            {{i.employee_name}}
                        </td>
                        <td>
                         {{i.leave_type}}
                        </td>
                        <td>{{i.from_date}}</td>
                        <td>{{i.to_date}}</td>
                        <td>{{i.total_days}}</td>
                        <td>{{i.dt}}</td>
                        <td>
                            {{i.absence_status}}
                        </td>
                        <td>
                            <a href="#" class="draft_action" data-id="{{i.id}}" data-leave-type-id="{{i.leave_type_id}}" data-leave-type-name="{{i.leave_type}}"
                            data-absence-status="{{i.absence_status}}" data-from-date="{{i.from_date|safe}}" data-to-date="{{i.to_date|safe}}"

                            data-absence-category="{{i.absence_category}}"
                            data-total-days="{{i.total_days}}" data-leave-reason="{{i.reason}}" data-alternative-contact-number="{{i.alternative_contact_number}}"
                            data-employee-reg-number="{{i.employee_reg_number}}" 
                            data-employee-name="{{i.employee_name}}" data-employee-id="{{i.employee_id}}" 
                            data-employee-replacer-name = "{{i.employee_replacer_name}}" data-employee-leave-replacer="{{i.employee_leave_replacer}}" 
                            data-draft-id = "{{i.id}}"
                            >
                          <div class="badge badge-success badge-success-alt" style="background-color: #02bfcd;
                          padding: 7px 30px;">Draft</div>
                          </a>
                        </td>
                   
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
             </div>

             {% endif %}
                <div class="card-box ">
                   <a href="user_leave_gantt_chart" style="    float: right;
                   padding: 3px 16px;    background: #72819c;    margin: 0px 11px;
                    color: white;" ><i class="fa-solid fa-chart-gantt"></i></a>

                <a href="leave_calendar" style="    float: right;
                padding: 3px 16px;    background: #72819c;
                color: white;" ><i class="fa fa-calendar" aria-hidden="true"></i></a>

                   <div class="row" style="">
                    <style>
                        .dropbtn {
                          background-color: #04aa6d00;
                          color: white;
                         
                          font-size: 16px;
                          border: none;
                        }
                        
                        .dropdown {
                          position: relative;
                          display: inline-block;
                        }
                        
                        .dropdown-content {
                          display: none;
                          position: absolute;
                          background-color: #f1f1f1;
                          min-width: 260px;
                          box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                          z-index: 1;
                        }
                        
                        .dropdown-content a {
                          color: black;
                          padding: 12px 16px;
                          text-decoration: none;
                          display: block;
                        }
                        
                        .dropdown-content a:hover {background-color: #ddd;}
                        
                        .dropdown:hover .dropdown-content {display: block;}
                        
                        .dropdown:hover .dropbtn {background-color: #02220300;}
                        </style>

                        
                    <div class="dropdown">
                        <button class="dropbtn">
                            <img style="width: 5%;    float: left;" src="https://cdn-icons-png.flaticon.com/512/1736/1736143.png"><span style="    color: #0c0c0c;
                               color: #0c0c0c;
                               float: left;
                                margin: 7px 1px;
                                font-weight: bold;
                                font-size: 12px;">
                                Employee</span> 
                        </button>
                        <div class="dropdown-content" style="overflow:scroll; height:500px;">
                            {% for i1 in child_response %}
                            {% if emp_id ==  i1.registration_number %}
                 
                            <a class="m-4 child_mark"  id="child_emp{{forloop.counter}}" onclick="child_function('{{i1.id}}','{{forloop.counter}}')" href="#" style="    background: #262435;
                            color: white;
                            padding: 12px 40px;
                            font-size: 12px;">{{i1.name}}</a>
                     
    
                        {% else %}
                            <a class="m-4 child_mark" id="child_emp{{forloop.counter}}" onclick="child_function('{{i1.id}}','{{forloop.counter}}')" href="#" style="    background:  #72819c;
                            color: white;
                            padding: 12px 40px;
                            font-size: 12px;">{{i1.name}}</a>
                     
                        {% endif %}
                        {% endfor %}
                        </div>
                      </div>
                    

                    

                   
                   </div>
                    <div class="table_rspnsv" id="tableview">
                        <div class="row2 tbl_stngs commen_table">




                            <table id="datatable" class="table table-bordered dt-responsive nowrap table-hover" style="width: 100%;">

                                <thead>
                                <tr>
                                    <th>Leave Type</th>
                                    <th>From Date</th>
                                    <th>To Date</th>
                                    <th >Total Days</th>
                                 
                                    <th>Created At</th>
                                    <th>
                                        Absence Status
                                    </th>
                                    <th>
                                        State
                                    </th>
                                   
                                    <th>
                                        Action
                                    </th>
                                   
                                    
                                  
                                </tr>
                                </thead>
                                <tbody id="leave_history_child">
                                    {% for history in leave_history_response %}
                                <tr>
                                    <td><a class="label-default" href="#/">{{history.holiday_status_id.1}}</a></td>
                                   <td>
                                    {{history.date_from}}
                                   </td>
                                   <td>
                                    {{history.date_to}}
                                   </td>
                                   <td>
                                    {{history.number_of_days}}
                                   </td>
                                 
                                   <td>
                                    {{history.create_date}}
                                   </td>
                                   <td>
                                    {{history.absence_status}}
                                   </td>
                                   <td style="    background: white;
                                   color: red;"> 
                                   <center>
                                    {% if history.state == "confirm" %}
                                    <span style="    background: #fed47e;
                                    color: black;
                                    font-size: 12px;
                                    padding: 4px 9px;
                                    border: 0;
                                    font-size: 12px;
                                    user-select: none;
                                    /* background-color: rgba(211, 211, 211, 0.5); */
                                    font-weight: 500;
                                    display: inline-block;
                                    max-width: 100%;
                                    white-space: nowrap;
                                    overflow: hidden;
                                    text-overflow: ellipsis;
                                    vertical-align: top;
                                    transition: none;
                                    border-radius: 12px;">To Approve</span>
                                    {%  elif history.state == "validate" %}
                                    <span style="background: #92d2a1;
                                    color: black;
                                    font-size: 12px;
                                    padding: 4px 9px;
                                    border: 0;
                                    font-size: 12px;
                                    user-select: none;
                                    /* background-color: rgba(211, 211, 211, 0.5); */
                                    font-weight: 500;
                                    display: inline-block;
                                    max-width: 100%;
                                    white-space: nowrap;
                                    overflow: hidden;
                                    text-overflow: ellipsis;
                                    vertical-align: top;
                                    transition: none;
                                    border-radius: 12px;">Approved</span>

                                    {% elif history.state == "refuse" %}
                                    <span style="background: #e8e8e8;
                                    color: black;
                                    font-size: 12px;
                                    padding: 4px 9px;
                                    border: 0;
                                    font-size: 12px;
                                    user-select: none;
                                    /* background-color: rgba(211, 211, 211, 0.5); */
                                    font-weight: 500;
                                    display: inline-block;
                                    max-width: 100%;
                                    white-space: nowrap;
                                    overflow: hidden;
                                    text-overflow: ellipsis;
                                    vertical-align: top;
                                    transition: none;
                                    border-radius: 12px;">Refused</span>

                                    {% elif history.state == "validate1" %}
                                    <span style="background: #fed47e;
                                    color: black;
                                    font-size: 12px;
                                    padding: 4px 9px;
                                    border: 0;
                                    font-size: 12px;
                                    user-select: none;
                                    /* background-color: rgba(211, 211, 211, 0.5); */
                                    font-weight: 500;
                                    display: inline-block;
                                    max-width: 100%;
                                    white-space: nowrap;
                                    overflow: hidden;
                                    text-overflow: ellipsis;
                                    vertical-align: top;
                                    transition: none;
                                    border-radius: 12px;">	Second Approval</span>
                                    {% else %}
                                    {{ history.state}}
                                    {% endif %}
                                </center>
                                   </td>

                                   <td>
                                    <a href="view_leave_more_details?id={{history.id}}">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                   </td>

                                </tr>
                                {% endfor %}
                           
                       

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end row -->
    </div>
    <!-- container -->
</div>
</div>
</div>
<div id="user_leave_draft"></div>
<style>


/* Important part */
.modal-dialog{
    overflow-y: initial !important
}
.modal-body{
    height: 80vh;
    overflow-y: auto;
}
</style>
<style>
    .confirm-box {
        width: 280px;
    position: absolute;
    top: 30%;
    left: 45%;
    z-index: 10;
    color: rgba(0,0,0,0.7);
    font-family: Helvetica;
    font-size: 15px;
    font-weight: bold;
    background: #DDD;
    border-radius: 0.4em;
    border: 1px solid rgba(0,0,0,0.6);
    box-shadow: 0 0 10px rgb(0 0 0 / 40%); 
  
  &:after {
   	content:"";
    display:table;
    clear:both;
  }

}

.confirm-box h1 {
 	text-align:center; 
  padding:10px 30px;
  line-height:1.2em;
  border-radius:0.4em 0.4em 0 0;
  text-shadow:0 1px 0 rgba(255,255,255,0.1);
	border-bottom:1px solid rgba(0,0,0,0.3);
  box-shadow:
    0 1px 0 rgba(255,255,255,0.3),
    inset 0 1px 0 rgba(255,255,255,0.3),
    inset 0 30px 30px rgba(255,255,255,0.2);
  margin-bottom:15px;
  background:#0088CC;
}


.confirm-box a {
 	display:block;
  position:relative;
  
  padding:7px 40px;
  width:130px;
  margin:0 auto;
  margin-bottom:15px;
  
  text-decoration:none;
  text-align:center;
  font-size:13px;

  border:1px solid rgba(0,0,0,0.7);
  border-radius:0.2em;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.5),
    inset 0 20px 20px rgba(255,255,255,0.2),
    1px 2px 1px rgba(0,0,0,0.2),
    0 0 2px 8px rgba(50,50,50,0.1);
  transition:all 0.3s ease-out;
  background:#d02211;
  z-index:100;
  
  font-weight:bold;
  color:rgba(0,0,0,0.6);
  text-shadow:0 1px 0 rgba(255,255,255,0.2);
  -webkit-font-smoothing: subpixel-antialiased;

  
  &:hover {
   	 box-shadow:
      inset 0 1px 0 rgba(255,255,255,0.5),
      inset 0 -20px 20px rgba(200,200,200,0.1),
      1px 2px 1px rgba(0,0,0,0.2),
      0 0 2px 8px rgba(100,100,100,0.1);
  }
  
  &:active {
   	top:1px; 
  }

}

#progress-bar {
 	width:90%;
  margin:0 auto;
  margin-bottom:15px;
	height:28px;
  border:1px solid rgba(0,0,0,0.8);
  background:#232323;
  border-radius:1em;
  box-shadow:inset 0 0 5px rgba(0,0,0,0.5);
}

#inner-pb {
	position:relative;
  border:1px solid rgba(0,0,0,0.8);
  width:0;
  
  
  height:22px;
  margin-left:5px;
  margin-top:2px;
  background: repeating-linear-gradient(-45deg, #625e74, #5d5970 20px, #5f5b72 20px, #57536b 40px);
  border-radius:0.8em;
  animation: roll 5s linear infinite;
  box-shadow: 
    inset 0 10px 10px rgba(255,255,255,0.2), 
    inset 0 1px 0 rgba(255,255,255,0.3), 
    inset 0 -5px 3px rgba(0,0,0,0.2),
    0 3px 2px rgba(0,0,0,0.3);
}

@-moz-keyframes roll {
	0% { width:0; }
  100% { width:95%; }
}

@-webkit-keyframes roll {
	0% { width:0; }
  100% { width:95%; }
}
</style>
<!-- <div class="modal modal-right fade" id="newuser" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
    <div class="modal-dialog modal-full" > -->
        <form class="submit_action"  action="user_leave_apply_action" method="POST" enctype="multipart/form-data" >
<div id="newuser" class="modal modal-right fade" role="dialog" data-backdrop="static"  >
<div class="modal-dialog modal-full">
<!-- Modal content-->
<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Leave Application Form</h4>
        <div class="pull-right"> <a class="btn enlarge_modal" data-toggle="tooltip" data-original-title="Fullscreen"><i
                        class="mdi mdi-crop-free" aria-hidden="true"></i> </a>
            <a class="btn dslarge_modal" data-toggle="tooltip" data-original-title="Back"><i
                        class="mdi mdi-arrow-expand-all" aria-hidden="true"></i> </a>
        </div>
    </div>
    
    <div class="confirm-box" id="kl2" style="display: none">
        <h1 style="    font-size: 14px;
        color: white;    background: #423d58;">Please wait...</h1>
        <div id="progress-bar">
            <div id="inner-pb"></div>
        </div>
      </div>
        {% csrf_token %}
        <input type="hidden" name="employee_name1" id="employee_name1" value="{{emp_name}}">
       
    <div class="modal-body">
        <input type="hidden" name="leave_type_nm" id="leave_type_nm">
      
            <div class="form_enterbox col-md-12">
                <div class="row mt-2">
                   <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12 mt-2">
                                <div class="form-group bmd-form-group" id="child_select1">
                                    <select name="employee_name" class="form-control select2 emp_name_action" id="emp_name_action">
                                        {% for i in child_response %}
                                        <option value="{{i.id}}">{{i.name}}[{{i.registration_number}}]</option>

                                        {% endfor %}
                                    </select>

                                    
                                    <!-- <input style="    background: #2b2c422b;
                                    color: black;" readonly value="{{emp_name}}" name="employee_name" type="text" class="input form-control getVal"> -->
                                    <label class="inputText input-has-value">Employee Name</label>
                                </div>
                            </div>

                            <div class="col-sm-4 pad5 mt-2">
                                <div class="form-group bmd-form-group">
                                    <input style="    background: #2b2c422b;
                                    color: black;" readonly value="{{emp_id}}" name="employee_number" id="employee_reg_number" type="text" class="input form-control">
                                    <label class="inputText">Employee Number</label>
                                </div>
                            </div>
                            <div class="col-sm-5 pad5 mt-2 ">
                                <div class="form-group bmd-form-group">
                                    <select class="input form-control" name="absence_status" id="absence_status" >
                                        <option>Confirmed</option>
                                        <option>Planned</option>

                                       
                                    </select>
                                    <label class="inputText">Absence Status</label>
                                </div>
                            </div>
                         
                            <div class="col-sm-12 pad5 mt-2" style="display:none" id="leave_avaiable_id">
                                <div class="form-group bmd-form-group">
                                    <input style="width: 33%;    background: #2b2c422b;" readonly id="available_leave" name="employee_available_leave" type="text" class="input form-control">
                                    <label class="inputText">Leave Available</label>
                                </div>
                            </div>
                            <div class="col-sm-9 pad5 mt-2">
                                <div class="form-group bmd-form-group">
                                    
                                    <div class="form-group"> 
                                        <input type="hidden" name="employee_replacer_text" id="employee_replacer_text">
                                        
                                        <select name="employee_leave_replacer" id="employee_leave_replacer" class="form-control select2 " >
                                        <option selected="selected" value="0">Select Employee Name</option>
                                        {% for i in replacer_response  %}
                                       
                                        <option value="{{i.id}}" >{{i.name}} {{i.registration_number}}</option>
                                      
                                        {% endfor %}
                                     
                                    </select> </div> 
                                    <label class="inputText">Replace By</label>
                                </div>
                            </div>
                            <div class="col-sm-6 pad5 mt-2">
                                <div class="form-group bmd-form-group">
                                    <input name="employee_alternative_contcat_no" id="employee_alternative_contcat_no" type="number"  class="input form-control">
                                    <label class="inputText">Emergency Contact Number During Leave</label>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-6">

                        <div class="row">
                            <div class="col-md-12 mt-2">
                                <div class="col-sm-12 pad5 ">
                                    <div class="form-group bmd-form-group">
                                        <input style="    background: #2b2c422b;
                                        color: black;" readonly value="{{emp_email}}" id="employee_email" name="employee_email" type="text" class="input form-control getVal">
                                        <label class="inputText input-has-value">Email</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-5 pad5  mt-2">
                                <div class="form-group bmd-form-group">
                                    <select class="input form-control" name="employee_leave_type" id="emp_name">
                                        <option value="no" selected="selected">Select Leave Type</option>

                                        {% for leave_type in leave_type_response %}
    
                                        <option value="{{leave_type.id}}">{{leave_type.name}}</option>
    
                                        {% endfor %}
                                    </select>
                                    <label class="inputText">Leave Type</label>
                                </div>
                            </div>
                            <div class="col-sm-5 pad5 mt-2 ">
                                <div class="form-group bmd-form-group">
                                  <input style="    background: #2b2c422b;" readonly class="input form-control" id="absence_category" name="absence_category" type="text">

                                       
                                    <label class="inputText">Absence Category</label>
                                </div>
                            </div>
                            <div class="col-md-6 mt-2">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group bmd-form-group">
                                            <div class="input-group bmd-date-group">
                                                <input  type="text" name="employee_leave_from_date" required class="form-control input" id="startDate" />
                                                <label class="bmd-label-floating inputText labl_insd">From</label>
                                                <div class="input-group-append"> <span class="input-group-text "><i class="fa fa-calendar"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="half_day1"  class="col-md-12" style="    margin: -28px 0px;
                                    padding: 16p 18px;display: none;
                                ">
                                      <input name="request_unit_half" id="myCheckbox" type="checkbox" value="Half day" /> <span style="font-size: 12px;
                                      font-weight: bold;">Half Day</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mt-2">
                                <div class="form-group bmd-form-group" id="to_date1">
                                    <div class="input-group bmd-date-group">
                                        <input type="text" name="employee_leave_to_date" autocomplete="off"   class="form-control input" id="endDate" />
                                        <label class="bmd-label-floating inputText labl_insd">To</label>
                                        <div class="input-group-append"> <span class="input-group-text "><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div id="to_date2" class="form-group bmd-form-group" style="display: none">
                                    <div class="input-group bmd-date-group">
                                        <select name="request_date_from_period" id="request_date_from_period"  class="form-control  " >
                                            <option value="am"  >Morning</option>
                                            <option   value="pm">Afternoon</option>
                                           
                                           
                                          
                                          
                                           
                                         
                                        </select>

                                        <label class="bmd-label-floating inputText labl_insd"> </label>
                                        <div class="input-group-append"> <span class="input-group-text "><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="col-md-12 mt-2 ">
                                <div class="form-group bmd-form-group">
                                    <input readonly style="    background: #2b2c422b;
                                    color: black;" type="text" name="employee_total_days" id="t1" class="input form-control">
                                    <label class="inputText">Total Days</label>
                                </div>
                            </div>
                            <div class="col-sm-12  mt-2">
                               
                                    <div class="form-group bmd-form-group">
    
                                        <textarea name="employee_leave_reason" id="employee_leave_reason" class="form-control input_textaerea"></textarea>
                                        <label class="inputText">Reason for Leave/Comments</label>
    
                                    </div>
                               
                            </div>
                        </div>
                    </div>



                 
                
                </div>
               

             

                <div class="row">
                    <div class="col-md-6 colp_r_15">
                        <div class="row">
                         
                            <style>
                                .select2-results{
                                    display: block!important;
                                }
                            </style>
                         
                        </div>
                    </div>
                
                </div>

                <div class="row">
                    <div class="col-12">
                        <h4 class="sub_hdng_edit">View Entitlement Balances</h4>

                       <div>
                        <a href="#" style="       background: #2b2c42c4;
    color: white;
    padding: 5px 13px;
    font-size: 14px;float: right;" class="entitle_balance_validate">
                           <i class="fa fa-check" aria-hidden="true"></i> Validate
                        </a>
                       </div>
                       
                    </div>
              
                    <div class="col-md-12 pad0 " >

                        <div class="tbl_stngs commen_table m-t-8">

                            <table id="example" class="table table-bordered dt-responsive nowrap table-hover dataTable no-footer" style="width: 100%">

                                <thead>
                                <tr>
                                    <th>Sr #</th>
                                    <th>Leave Type</th>
                                    <th>Total </th>
                                    <th>Total Available</th>
                                    <th>Total Taken</th>
                                  
                                </tr>
                                </thead>
                           
                                    <tbody id="entitlement_data1">
                                    {% for i in entitlement_balances_response %}
                                <tr>
                                    <td>{{forloop.counter}}</td>
                                    <td>
                                   {{i.leave_type}}
                                    </td>
                                    <td>{{i.total_leaves}}</td>
                                    <td>{{i.total_leave_balance}}</td>
                                    <td>
                                        {{ i.total_leaves|leave_taken_method:i.total_leave_balance }}
                                    </td>
                                </tr>
                      
                                {% endfor %}
                                </tbody>
                               
                            </table>
                        </div>
                    </div>
                </div>
               
               


                <div class="row" id="attachment" style="display:none">
                    <div class="col-12 m-t-10">
                        <h4 class="sub_hdng_edit" style="background-color: #2b2c42!important">Attachment </h4>
                    </div>

                    <div class="col-md-12 pad0 ">
                        <div class="table_createNewBtn"><a style="color: white"  href="#" class="add_file_action"> + Add File</a></div>
                  
                    </div>



                    <div id="add_file1" style="display: none;width:300px;">
                        <div class="row">
                            <div class="col-md-12 colp_r_15">
                                <div class="col-lg-12 col-md-12 col-sm-12 resumeFileField">
                                    <div class="form-group">
                                        <div class="file-upload">

                                            <div class="image-upload-wrap">
                                                <input class="file-upload-input" id="f123" name="employee_attached_file" type='file' onchange="readURL(this);" accept="image/*" />
                                                <div class="drag-text">
                                                    <h3>Drag and drop a file or select File</h3>
                                                </div>
                                            </div>
                                            <div class="file-upload-content">
                                                <img class="file-upload-image" src="#" alt="your image" />
                                                <div class="image-title-wrap">
                                                    <button type="button" onclick="removeUpload()" class="remove-image">Remove <span class="image-title">Uploaded Image</span></button>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              

            </div>

       
         
      
    </div>
    <input type="hidden" name="leave_draft_id" id="leave_application_type">
    <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <a href="#" class="btn  leave_draft_action" style="    background: #14bcd7;
        color: white;" id="leave_draft_btn">Draft</a>
        <button type="submit" class="btn btn-primary" >Submit</button>
    </div>
    

</div>
</div>
</div>


</form>

<style>
    .lds-dual-ring.hidden { 
display: none;
}
.lds-dual-ring {
  display: inline-block;
  width: 80px;
  height: 80px;
}
.lds-dual-ring:after {
  content: " ";
  display: block;
  width: 64px;
  height: 64px;
  margin: 5% auto;
  border-radius: 50%;
  border: 6px solid #fff;
  border-color: #fff transparent #fff transparent;
  animation: lds-dual-ring 1.2s linear infinite;
}
@keyframes lds-dual-ring {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}


.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0,0,0,.8);
    z-index: 999;
    opacity: 1;
    transition: all 0.5s;
}
</style>
     <div id="loader" class="lds-dual-ring hidden overlay"></div>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

<script src="{% static 'adminnew/js/custome.js' %}"></script>

<script src="{% static 'adminnew/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'adminnew/js/metisMenu.min.js' %}"></script>
<script src="{% static 'adminnew/js/jquery.slimscroll.js' %}"></script>
<script src="{% static 'adminnew/js/moment.js' %}"></script>
<script src="{% static 'adminnew/js/bootstrap-timepicker.js' %}"></script>
<script src="{% static 'adminnew/js/bootstrap-datetimepicker.min.js' %}"></script>
<!--<script src="js/moment.js"></script>-->

<script src="{% static 'adminnew/js/jquery.core.js' %}"></script>
<script src="{% static 'adminnew/js/jquery.app.js' %}"></script>


<script>
$(window).scroll(function () {
var scroll = $(window).scrollTop();
if (scroll >= 0) {
    $("html").addClass("modal-open2");
}
});
</script>
<script>
$(document).ready(function() {
// Check if body height is higher than window height :)
if ($("body").height() > $(window).height()) {
    // alert('asda')
    $('html').addClass('modal-open2');
}
});
</script>



<script>
let eleBtnStart = document.querySelector("#btnStart");
let eleBtnStop = document.querySelector("#btnStop");
let eleTimer = document.querySelector("#divTimer");

let timeTicker = (() => {
var hours = minutes = seconds = 0;
var timerTick;
return {
    start : () => {
        if(!timerTick) {
            timerTick = setInterval(() => {
                seconds++;
                if(seconds == 60) {
                    minutes += 1;
                    seconds = 0;
                    if(minutes == 60) {
                        hours += 1;
                        minutes = 0;
                    }
                }
                eleTimer.innerHTML = `
${hours.toString().length == 1 ? "0" + hours : hours}
: ${minutes.toString().length == 1 ? "0" + minutes:minutes} Hrs`;
            },25);
        }
    },
    stop : () => {
        if(timerTick) {
            clearInterval(timerTick);
            timerTick = false;
        }
    },
    reset : () => {
        seconds = minutes = hours = 0;
        clearInterval(timerTick);
        timerTick = false;
        eleTimer.innerHTML = `0${hours}:0${minutes}  Hrs`;
    }
}
})();
eleBtnStart.addEventListener('click', () => {
timeTicker.start();
});
eleBtnStop.addEventListener('click', () => {
timeTicker.stop();
});

$('#btnStart').click(function (){
$(this).closest('.timer').addClass('timer_actv')
});
$('#btnStop').click(function (){
$(this).closest('.timer').removeClass('timer_actv')
});

$('.timerbtn_start').click(function (){
$(this).addClass('disnone_timer')
$(this).siblings('.timerbtn').addClass('timerbtn_stop');
$(this).parent().siblings('.divTimer').addClass('divTimer_dsplay')

});
$('.timerbtn_stop').click(function (){
$(this).removeClass('timerbtn_stop')
$(this).siblings('.timerbtn').removeClass('disnone_timer');
$(this).parent().siblings('.divTimer').removeClass('divTimer_dsplay')
});


</script>
<script>
$(document).ready(function () {
$(window).click(function() {
    var scroll = $(window).scrollTop();
    if (scroll >= 0) {
        $("#wrapper").addClass("modal-open2");
    }
});
});
</script>
<script src="{% static 'adminnew/js/jquery.min.js' %}"></script>
<script src="{% static 'adminnew/js/jquery.core.js'  %}"></script>
<script src="{% static 'adminnew/js/jquery.app.js' %}"></script>
<!-- App js -->
<!-- <script src="{% static 'adminnew/js/select2.full.js' %}"></script>
<script src="{% static 'adminnew/js/select2-custome.js' %}"></script> -->


<script src="{% static 'adminnew/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'adminnew/js/dataTables.bootstrap4.min.js' %}"></script>

<script type="text/javascript">
$(document).ready(function() {

// Default Datatable
$('#datatable').DataTable();
$('#responsive-datatable').DataTable();

$('#datetimepickereffcet-start').datetimepicker({
    format: 'DD-MM-YYYY'
});
$('#datetimepickereffcet-end').datetimepicker({
    format: 'DD-MM-YYYY',
    useCurrent: false //Important! See issue #1075
});
$("#datetimepickereffcet-start").on("dp.change", function(e) {
    $('#datetimepickereffcet-end').data("DateTimePicker").minDate(e.date);
});
$("#datetimepickereffcet-end").on("dp.change", function(e) {
    $('#datetimepickereffcet-start').data("DateTimePicker").maxDate(e.date);
});

$('#datetimepicker-role-start').datetimepicker({
    format: 'DD-MM-YYYY'
});
$('#datetimepicker-role-end').datetimepicker({
    format: 'DD-MM-YYYY',
    useCurrent: false //Important! See issue #1075
});
$("#datetimepicker-role-start").on("dp.change", function(e) {
    $('#datetimepicker-role-end').data("DateTimePicker").minDate(e.date);
});
$("#datetimepicker-role-end").on("dp.change", function(e) {
    $('#datetimepicker-role-start').data("DateTimePicker").maxDate(e.date);
});

});
</script>

<script type="text/javascript">
$(document).ready(function() {
$(".appnd_user_btn").click(function() {


    $(".apenduser").append("<tr>\n" +
        "                                    <td class=\"th_btnpand\">\n" +
        "                                        <div class=\"appnd_user_minus_btn appnd_minus_btn\">-</div>\n" +
        "                                    </td>\n" +
        "                                    <td class=\"th_user_role\">\n" +
        "                                        <select name=\"role_id[]\" class=\"form-control\">\n" +
        "                                            {% for role in  role_data %}\n" +
        "                                           <option value=\"{{role.id}}\">{{role.role_name}}</option>\n" +
        "                                           {% endfor %}\n" +
        "                                        </select>\n" +
        "                                    </td>\n" +
        "                                    <td class=\"th_user_decrptn\">\n" +
        "                                        <input name=\"role_description[]\" class=\"form-control\">\n" +
        "                                    </td>\n" +
        "                                    <td class=\"th_user_strtdate\">\n" +
        "                                        <div class=\"input-group date\">\n" +
        "                                            <input name=\"role_start_dt[]\" type=\"date\" class=\"input form-control\" id=\"datetimepicker\"> \n" +
        "                                        </div>\n" +
        "                                    </td>\n" +
        "                                    <td class=\"th_user_enddate\">\n" +
        "                                        <div class=\"input-group date\">\n" +
        "                                            <input name=\"role_end_dt[]\" type=\"date\" class=\"input form-control\" id=\"datetimepicker\"> \n" +
        "                                        </div>\n" +
        "                                    </td>\n" +
        "                                </tr>");
    $(".appnd_user_minus_btn").click(function() {
        $(this).parent().parent().remove();
    });
});
});
</script>


<script>

    $("#passwd_day_btn").click(function(){
        document.getElementById("password_effective_date").style = "block"
    
    })

    $("#passwd_no_expire1").click(function(){    

        $("#password_effective_date").hide();
     
        document.getElementById("password_effective_date").style = "none"
    })
</script>


<script>

    $("#manually").click(function(){
        $("#password-div").show();
    })
</script>
<script>
    $("#automatically").click(function(){
        $("#password-div").hide();
    })
</script>

<script>
    
    $("#emp_name").change (function () {  
       
        var selectedemploye_name = $(this).children("option:selected").val();  

        var selected_employee_id = $('#emp_name_action').val();
        
        // alert(selectedemploye_name)

        // if(selectedemploye_name == "Annual Vacation"){
            

        //     $("#annual_leave_div").show();
        // }
        // else{
        //     $("#annual_leave_div").hide();
        // }



        $.ajax({
            url: 'get_total_available_leave_count',
            // datatype: 'json',
            data: {
                'leave_type': selectedemploye_name,
                'selected_employee_id':selected_employee_id       
            },
            type: 'GET',
            success: function (data) {  
                var response_message = data['respose_status']
                var half_day_status = data['half_day_status']
                var requires_allocation = data['requires_allocation']
                var support_document = data['support_document']
                
                if(support_document == true){
                    $("#attachment").show()
                }
                else{
                    $("#attachment").hide()
                }
                
               
                if(requires_allocation == "yes"){
                    $("#leave_avaiable_id").show()
                    $("#absence_category").val("Paid Leave")
                }
                else{
                    $("#leave_avaiable_id").hide()
                    $("#absence_category").val("Unpaid Leave")
                }
                
             
                if(half_day_status == "half_day"){
                    $("#half_day1").show();
                }
                else{
                    $("#half_day1").hide();
                }

               
                if(response_message == "success"){

                    var annual_status = data['annual_status']
                    
                    if(annual_status == true){
                        // $("#annual_leave_div").show();
                    }
                    else{
                        // $("#annual_leave_div").hide();
                    }
                    $("#leave_type_nm").val(data['leave_type_name'])
                    $("#available_leave").val(data['total_available_leave'])
                }
                else{
                    $("#annual_leave_div").hide();
                    $("#available_leave").val(0)
                    Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'The chosen leave option is not available !',
 
                    })
                } 
            }   
        });  
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
var message = `{{message}}`
if(message == "added"){
    Swal.fire({
  icon: 'success',
  title: 'add...',
  text: 'create new user data successfully',
})
}

else if(message == "already_exists"){
    Swal.fire({
  icon: 'error',
  title: 'Oops...',
  text: 'User  already exists!',
 
})
}
</script>
<script>
$("#to_dt_change").on("change",function(){
    
    var selected = $(this).val();
    var date = new Date($('#from_dt_change').val());
    var start = $(this).val();
    var end = $('#from_dt_change').val();
    var start = new Date(start);
    end   = new Date(end);
    diff  = new Date(start - end);
    days  = diff/1000/60/60/24;
    days = days+1
//    alert(days)
   $("#total_days").val(days)
   
});
</script>

<script>
    $(function(){
var dtToday = new Date();

var month = dtToday.getMonth() + 1;
var day = dtToday.getDate();
var year = dtToday.getFullYear();
if(month < 10)
    month = '0' + month.toString();
if(day < 10)
    day = '0' + day.toString();

var minDate= year + '-' + month + '-' + day;

$('#to_dt_change').attr('min', minDate);

$('#from_dt_change').attr('min', minDate);
});
</script>


<script>

    $("#from_dt_change").on("change",function(){
        var dt = $('#from_dt_change').val();
        // alert(dt)
        var dtToday = new Date(dt);
        
        var month = dtToday.getMonth() + 1;
        var day = dtToday.getDate();
        var year = dtToday.getFullYear();
        if(month < 10)
            month = '0' + month.toString();
        if(day < 10)
            day = '0' + day.toString();
        
        var minDate= year + '-' + month + '-' + day;
        
        $('#to_dt_change').attr('min', minDate);
    
    
    });
        </script>



<script>
    $(window).scroll(function () {
        var scroll = $(window).scrollTop();
        if (scroll >= 0) {
            $("html").addClass("modal-open2");
        }
    });
</script>
<script>
    $(document).ready(function() {
        // Check if body height is higher than window height :)
        if ($("body").height() > $(window).height()) {
            // alert('asda')
            $('html').addClass('modal-open2');
        }
    });
</script>



<script>
    let eleBtnStart = document.querySelector("#btnStart");
    let eleBtnStop = document.querySelector("#btnStop");
    let eleTimer = document.querySelector("#divTimer");

    let timeTicker = (() => {
        var hours = minutes = seconds = 0;
        var timerTick;
        return {
            start : () => {
                if(!timerTick) {
                    timerTick = setInterval(() => {
                        seconds++;
                        if(seconds == 60) {
                            minutes += 1;
                            seconds = 0;
                            if(minutes == 60) {
                                hours += 1;
                                minutes = 0;
                            }
                        }
                        eleTimer.innerHTML = `
${hours.toString().length == 1 ? "0" + hours : hours}
: ${minutes.toString().length == 1 ? "0" + minutes:minutes} Hrs`;
                    },25);
                }
            },
            stop : () => {
                if(timerTick) {
                    clearInterval(timerTick);
                    timerTick = false;
                }
            },
            reset : () => {
                seconds = minutes = hours = 0;
                clearInterval(timerTick);
                timerTick = false;
                eleTimer.innerHTML = `0${hours}:0${minutes}  Hrs`;
            }
        }
    })();
 eleBtnStart.addEventListener('click', () => {
        timeTicker.start();
    });
    eleBtnStop.addEventListener('click', () => {
        timeTicker.stop();
    });

    $('#btnStart').click(function (){
        $(this).closest('.timer').addClass('timer_actv')
    });
    $('#btnStop').click(function (){
        $(this).closest('.timer').removeClass('timer_actv')
    });

    $('.timerbtn_start').click(function (){
        $(this).addClass('disnone_timer')
        $(this).siblings('.timerbtn').addClass('timerbtn_stop');
        $(this).parent().siblings('.divTimer').addClass('divTimer_dsplay')

    });
    $('.timerbtn_stop').click(function (){
        $(this).removeClass('timerbtn_stop')
        $(this).siblings('.timerbtn').removeClass('disnone_timer');
        $(this).parent().siblings('.divTimer').removeClass('divTimer_dsplay')
    });


</script>
<script>
    $(document).ready(function () {
        $(window).click(function() {
            var scroll = $(window).scrollTop();
            if (scroll >= 0) {
                $("#wrapper").addClass("modal-open2");
            }
        });
    });

    
</script>


<script src="{% static 'adminnew/js/jquery.core.js' %}"></script>
<script src="{% static 'adminnew/js/jquery.app.js' %}"></script>
<!-- App js -->
<script src="{% static 'adminnew/js/select2.full.js' %}"></script>
<script src="{% static 'adminnew/js/select2-custome.js' %}"></script>


<script src="{% static 'adminnew/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'adminnew/js/dataTables.bootstrap4.min.js' %}"></script>

<script>
    $(document).ready(function () {
    $('#example').DataTable();
    $('#example111').DataTable();
});
</script>
<script type="text/javascript">
    $(document).ready(function() {
        // Default Datatable
        var dtToday = new Date();
    
    var month = dtToday.getMonth() + 1;
    var day = dtToday.getDate();
    var year = dtToday.getFullYear();
    if(month < 10)
        month = '0' + month.toString();
    if(day < 10)
        day = '0' + day.toString();
    
    var minDate1= year + '-' + month + '-' + day;
   
        $('#datatable').DataTable();
        // $('#entitlementsheet').DataTable();
        $('#supprtDocmnt').DataTable();
        $('#responsive-datatable').DataTable();
        $('#startDate').datetimepicker({
            
            format: 'YYYY-MM-DD'
            
        });
        $('#startDate').data("DateTimePicker").minDate(minDate1);
        $('#endDate').datetimepicker({
            format: 'YYYY-MM-DD',
            useCurrent: false //Important! See issue #1075
        });
        $("#startDate").on("dp.change", function(e) {
            $('#endDate').data("DateTimePicker").minDate(e.date);
        });
        $("#endDate").on("dp.change", function(e) {
            $('#startDate').data("DateTimePicker").maxDate(e.date);

            var start = $(this).val();
          
            var end = $('#startDate').val();
          
          
            
            //    alert(days)

            var dt1 = new Date(end);
            var dt2 = new Date(start);
 
            var time_difference = dt2.getTime() - dt1.getTime();
            var result = time_difference / (1000 * 60 * 60 * 24);
           
            $("#t1").val(result+1)

            
        });
    });
</script>

<script>
    var image_byte_code = false
    function readURL(input) {
        if (input.files && input.files[0]) {

            var reader = new FileReader();

            reader.onload = function(e) {
                $('.image-upload-wrap').hide();
                image_byte_code = e.target.result

                $('.file-upload-image').attr('src', e.target.result);
                $('.file-upload-content').show();

                $('.image-title').html(input.files[0].name);
            };


            // alert(document.getElementById("f123").value)
            $("#f12").val(document.getElementById("f123").value)
            reader.readAsDataURL(input.files[0]);

        } else {
            removeUpload();
        }
    }

    function removeUpload() {
        image_byte_code = false;
        $('.file-upload-input').replaceWith($('.file-upload-input').clone());
        $('.file-upload-content').hide();
        $('.image-upload-wrap').show();
    }
    $('.image-upload-wrap').bind('dragover', function() {
        $('.image-upload-wrap').addClass('image-dropping');
    });
    $('.image-upload-wrap').bind('dragleave', function() {
        $('.image-upload-wrap').removeClass('image-dropping');
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>

    $(".add_file_action").click(function(){

        $("#add_file1").show();
    })
</script>

{% if messages %}
   <script>
    {% for message in messages %}
        message1 = "{{message}}"
       

      
       
        if(message1 == "error"){

            Swal.fire({
  icon: 'error',
  title: 'Oops...',
  text: "{{ message }}",
 
})



        }
        else{

            Swal.fire(
				  '',
				  '{{ message }}',
				  '{{message.tags}}'
				)
      
        }
    {% endfor %}
   </script>
{% endif %}

<script>
    const checkbox = document.getElementById('myCheckbox')

checkbox.addEventListener('change', (event) => {
  if (event.currentTarget.checked) {
    
    $("#t1").val(0.5)
    $("#to_date2").show();
    $("#to_date1").hide();
  
  } else {
    // alert('not checked');
    $("#to_date2").hide()
    $("#to_date1").show()

    var start =  $('#endDate').val();
          
          var end = $('#startDate').val();

         
        
        
          
          //    alert(days)

          var dt1 = new Date(end);
          var dt2 = new Date(start);

          var time_difference = dt2.getTime() - dt1.getTime();
          var result = time_difference / (1000 * 60 * 60 * 24);
         
          $("#t1").val(result+1)

 
    
  }
})
</script>

<script>



$("#emp_name_action").change(function(){
    var selectedemploye_name = $(this).children("option:selected").val();  
   
   
    $.ajax({
            url: 'get_selected_employee_entitlement_balance',
            // datatype: 'json',
            data: {
                'employee_id': selectedemploye_name       
            },
            type: 'GET',
            success: function (data) {  
                employee_reg_number = data['employee_reg_number']
                employee_name1 = data['employee_name1']
                $("#employee_reg_number").val(employee_reg_number)
    $("#employee_name1").val(employee_name1)

             
            

            //    $("#entitlement_data1").html(data);

          
                
            }
            
        });
})
</script>


<script>
    function child_function(id,count1){
     
        count = `{{child_count}}`
        $(".child_mark").css("background-color","#72819c");
        var b2 = "child_emp"+count1
        document.getElementById(b2).style.backgroundColor = "#262435";
     
        
//         for(let i=1;i<=count;i++)
// {
//     var b1 = "child_emp"+i
//     var b2 = "child_emp"+count1
//     if(b1==b2){
//         document.getElementById(b2).style.backgroundColor = "#262435";
//     }
//     else{
//         document.getElementById(b1).style.backgroundColor = "#72819c";

//     }
  
//   console.log(i);
  
// }






        $.ajax({
                type: "GET",
                url: "get_child_based_leave_history",
                data: {
                    'employee_id': id           
                },
                beforeSend: function() {
                    $('#loader').removeClass('hidden')
                },
                success: function(data){
                    $("#leave_history_child").html(data);
                },
                complete: function(){
                    $('#loader').addClass('hidden')
                },
            });



        
    }
</script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    $(".submit_action").submit(function(){
        event.preventDefault()
        

        employee_name1 = $("#employee_name1").val()
        employee_name = $("#emp_name_action").val()
        leave_type_nm = $("#leave_type_nm").val()
        employee_number = $("#employee_reg_number").val()
        absence_status = $("#absence_status").val()
        available_leave = $("#available_leave").val()
        employee_leave_replacer = $("#employee_leave_replacer").val()
        employee_alternative_contcat_no = $("#employee_alternative_contcat_no").val()
        employee_email = $("#employee_email").val()
        employee_leave_type = $("#emp_name").val()
        absence_category = $("#absence_category").val()
        startDate = $("#startDate").val()
        let request_unit_half = $('#myCheckbox').is(':checked');

        if(request_unit_half == true){
            request_unit_half = "Half day"
        }

       
        endDate = $("#endDate").val()
        request_date_from_period = $("#request_date_from_period").val()
        employee_total_days = $("#t1").val()
        employee_leave_reason = $("#employee_leave_reason").val()
        $form = $(this)
        
        
        var data1 = new FormData()
        data1.append('employee_attached_file', $('#f123')[0].files[0])
        data1.append('employee_name1', employee_name1)
        data1.append('leave_type_nm',leave_type_nm)
        data1.append('employee_name',employee_name)
        data1.append('employee_email',employee_email)
        data1.append('employee_number',employee_number)
        data1.append('employee_leave_type',employee_leave_type)
        data1.append('employee_leave_from_date',startDate)
        data1.append('employee_leave_to_date',endDate)
        data1.append('employee_available_leave',available_leave)
        data1.append('employee_leave_reason',employee_leave_reason)
        data1.append('employee_total_days',employee_total_days)
        data1.append('employee_leave_replacer',employee_leave_replacer)
        data1.append('employee_alternative_contcat_no',employee_alternative_contcat_no)
        data1.append('request_unit_half',request_unit_half)
        data1.append('absence_status',absence_status)
        data1.append('request_date_from_period',request_date_from_period)
        data1.append('absence_category',absence_category)
        data1.append('leave_draft_id',$("#leave_application_type").val())
        data1.append('image_byte_code',image_byte_code)

        csrf_token = $('input[name="csrfmiddlewaretoken"]').val();
        console.log("data:::::")
        console.log(data1)
      
        
        $.ajax({                    
        url: "user_leave_apply_action",                    
        data: data1,
		type: 'post',
        processData: false,
        contentType: false,
        success: function (data) {  
            
           

            if(data['submit_message'] == "success"){
                window.location.href = "leave_management"
            }
            else{
                $("#kl2").hide();
              
                swal('',data['message'], "error");

            }

       

        }
      });
        
        // alert("hhh")
        event.preventDefault()
        $("#kl2").show();
    })
</script>

<script>
$("#employee_leave_replacer").change(function() {
    
    $("#employee_replacer_text").val($(this).find("option:selected").text())




});







    $(".leave_draft_action").click(function(){
        employee_name1 = $("#employee_name1").val()
        employee_name = $("#emp_name_action").val()
        leave_type_nm = $("#leave_type_nm").val()
        employee_number = $("#employee_reg_number").val()
        absence_status = $("#absence_status").val()
        available_leave = $("#available_leave").val()
        employee_leave_replacer = $("#employee_leave_replacer").val()
        employee_alternative_contcat_no = $("#employee_alternative_contcat_no").val()
        employee_email = $("#employee_email").val()
        employee_leave_type = $("#emp_name").val()
        absence_category = $("#absence_category").val()
        startDate = $("#startDate").val()
        employee_replacer_text  = $("#employee_replacer_text").val()
        let request_unit_half = $('#myCheckbox').is(':checked');
        if(request_unit_half == true){
            request_unit_half = "Half day"
        }

       
        endDate = $("#endDate").val()
        request_date_from_period = $("#request_date_from_period").val()
        employee_total_days = $("#t1").val()
        employee_leave_reason = $("#employee_leave_reason").val()
        var data1 = new FormData()
        data1.append('employee_attached_file', $('#f123')[0].files[0])
        data1.append('employee_name1', employee_name1)
        data1.append('leave_type_nm',leave_type_nm)
        data1.append('employee_name',employee_name)
        data1.append('employee_email',employee_email)
        data1.append('employee_number',employee_number)
        data1.append('employee_leave_type',employee_leave_type)
        data1.append('employee_leave_from_date',startDate)
        data1.append('employee_leave_to_date',endDate)
        data1.append('employee_available_leave',available_leave)
        data1.append('employee_leave_reason',employee_leave_reason)
        data1.append('employee_total_days',employee_total_days)
        data1.append('employee_leave_replacer',employee_leave_replacer)
        data1.append('employee_alternative_contcat_no',employee_alternative_contcat_no)
        data1.append('request_unit_half',request_unit_half)
        data1.append('absence_status',absence_status)
        data1.append('request_date_from_period',request_date_from_period)
        data1.append('absence_category',absence_category)
        data1.append('employee_replacer_text',employee_replacer_text)
        var token = '{{csrf_token}}';

        csrf_token = $('input[name="csrfmiddlewaretoken"]').val();
        console.log("data:::::")
        console.log(data1)
        $("#kl2").show();
        $.ajax({   
            headers: { "X-CSRFToken": token },                 
        url: "user_leave_apply_to_draft_action",                    
        data: data1,
		type: 'post',
        processData: false,
        contentType: false,
        success: function (data) {  
           
           

            if(data['message'] == "success"){
                
                window.location.href = "leave_management"
            }
            else{
                $("#kl2").hide();
               
                swal('',data['message'], "error");

            }

       

        }
      });
      

        // console.log("name1::::",employee_name1)
        // console.log("employee_name::::",employee_name)
        // console.log("leave_type_nm:::::",leave_type_nm)
        // console.log("employee_number:::::",employee_number)
        // console.log("absence_status::::::",absence_status)
        // console.log("available_leave:::::",available_leave)
        // console.log("employee_leave_replacer::::",employee_leave_replacer)
        // console.log("employee_alternative_contcat_no::::",employee_alternative_contcat_no)
        // console.log("employee_email:::::",employee_email)
        // console.log("employee_leave_type::::",employee_leave_type)
        // console.log("absence_category::",absence_category)
        // console.log("startDate::::",startDate)
        // console.log("request_unit_half:::",request_unit_half)
        // console.log("endDate::::::",endDate)
        // console.log("request_date_from_period:::",request_date_from_period)
        // console.log("employee_total_days::::::::",employee_total_days)
        // console.log("employee_leave_reason:::",employee_leave_reason)

    })
</script>
<script>
    $(document).ready(function() {
  $("#example5").DataTable({
    aaSorting: [],
    responsive: true,

    columnDefs: [
      {
        responsivePriority: 1,
        targets: 0
      },
      {
        responsivePriority: 2,
        targets: -1
      }
    ]
  });

  $(".dataTables_filter input")
    .attr("placeholder", "Search here...")
    .css({
      width: "300px",
      display: "inline-block"
    });

  $('[data-toggle="tooltip"]').tooltip();
});

</script>



<script>
    $(".draft_action").click(function(){
        // $('.').val(null).trigger("change")
    //    $('span.select2-selection__rendered').html('sss');
        // $('.emp_name_action').prop('selectedIndex',0);
        var id = $(this).attr("data-id")
        leave_type_id = $(this).attr("data-leave-type-id")
        leave_type_name = $(this).attr("data-leave-type-name")
        var absence_status = $(this).attr('data-absence-status')



        $("#employee_alternative_contcat_no").val($(this).attr('data-alternative-contact-number'))

        if($(this).attr("data-employee-reg-number") == 'None'){

        }
        else{
        $("#employee_reg_number").val($(this).attr("data-employee-reg-number"))
    }
        
        $("#employee_leave_reason").val($(this).attr("data-leave-reason"))
        if($(this).attr('data-total-days') == 'None'){

        }
        else{
            $("#t1").val($(this).attr('data-total-days'))
        }

        if($(this).attr('data-from-date') == "None"){
            $("#startDate").val('')
        }
        else{
       
        $("#startDate").val($(this).attr('data-from-date'))

        }
        $("#absence_category").val($(this).attr('data-absence-category'))
        if($(this).attr('data-to-date') == 'None'){

        }
        else{
            $("#endDate").val($(this).attr('data-to-date'))
        }
       

       
        if(absence_status == "Confirmed"){
            var select_absense_status = $('#absence_status');
            select_absense_status.empty().append('<option value='+absence_status+'>'+absence_status+'</option>');
            select_absense_status.append('<option value=Planned>Planned</option>');

        }
        else if(absence_status == "Planned"){
            var select_absense_status = $('#absence_status');
            select_absense_status.empty().append('<option value='+absence_status+'>'+absence_status+'</option>');
            select_absense_status.append('<option value=Confirmed>Confirmed</option>');
        }
      
        var select = $('#emp_name');
       
        $("#leave_type_nm").val(leave_type_name)
        
        if(leave_type_id == 'None'){
            select.empty().append('<option value=0>Select Leave Type</option>');
        }
        else if(leave_type_name == ''){
           
            select.empty().append('<option value=0>Select Leave Type</option>');
        }
        else{
            select.empty().append('<option value='+leave_type_id+'>'+leave_type_name+'</option>');
        }

        
        {{ leave_type_response|safe }}.forEach(item => {

            if(item['id'] == leave_type_id){

            }
            else{
                select.append('<option value='+item['id']+'>'+item['name']+'</option>');
            }
 

 
})


var employee_select = $("#emp_name_action");






employee_name = $(this).attr("data-employee-name")
employee_id = $(this).attr("data-employee-id")
$("#employee_name1").val(employee_name)

console.log("employee_name::::",employee_name)
console.log("employee_id::::::",employee_id)

employee_select_option = '<option value='+employee_id+'>'+employee_name+'</option>'

employee_select.empty();
{{ child_response|safe }}.forEach(item => {

    if(item['id'] == employee_id){
       
    }
    else{
        employee_select_option= employee_select_option+'<option value='+item['id']+'>'+item['name']+'</option>';
    }
})
   $('span#select2-emp_name_action-container').html(employee_name);
$('#emp_name_action')

    .find('option')
    .empty()
    .end()
    .append(employee_select_option)
    .val(employee_id)
;





employee_replacer_name = $(this).attr('data-employee-replacer-name');
employee_leave_replacer = $(this).attr('data-employee-leave-replacer');
console.log("employee_leave_replacer:::",employee_leave_replacer)
console.log("employee_replacer_name:::::",employee_replacer_name)

$('span#select2-employee_leave_replacer-container').html(employee_replacer_name);


var leave_replacer_select = $("#employee_leave_replacer");
leave_replacer_select.empty();
leave_replacer_option = ''
if(employee_leave_replacer > 0){

    leave_replacer_option = leave_replacer_option+'<option value='+employee_leave_replacer+'>'+employee_replacer_name+'</option>';
    
}
{{ replacer_response|safe }}.forEach(item => {

if(item['id'] == employee_leave_replacer){
   
}
else{
    leave_replacer_option= leave_replacer_option+'<option value='+item['id']+'>'+item['name']+'</option>';
}
})
$('#employee_leave_replacer')

    .find('option')
    .empty()
    .end()
    .append(leave_replacer_option)
    .val(employee_leave_replacer)
;


$("#leave_application_type").val($(this).attr("data-draft-id"))



$("#leave_draft_btn").hide()


        $("#newuser").modal("show")
    //     var url ="leave_draft_modal_action";
    //     $.ajax({                      
    //     url: url,        
    //     data: {
    //       'id': id       
    //     },
    //     success: function (data) {  
    //         alert(data)
    //       $("#user_leave_draft").html(data); 

    //       $("#draft_leave").modal("show")

    //     }
    //   });
    })
</script>

<script>
    $(".newbtn_crete").click(function(){
        $("#leave_draft_btn").show()
        $("#leave_application_type").val(0)
       
        employee_name = `{{emp_name}}`
        employee_id = `{{odoo_id}}`
       

        console.log("employee_name1111::::",employee_name)
        console.log("employee_id111::::::",employee_id)
        
        var employee_select = $("#emp_name_action");
        $("#employee_reg_number").val(`{{emp_id}}`)
     
employee_select_option = '<option value='+employee_id+'>'+employee_name+'</option>'
$("#employee_name1").val(employee_name)
employee_select.empty();
{{ child_response|safe }}.forEach(item => {

    if(item['id'] == employee_id){
       
    }
    else{
        employee_select_option= employee_select_option+'<option value='+item['id']+'>'+item['name']+'</option>';
    }
})
   $('span#select2-emp_name_action-container').html(employee_name);
$('#emp_name_action')

    .find('option')
    .empty()
    .end()
    .append(employee_select_option)
    .val(employee_id)
;




var leave_replacer_select = $("#employee_leave_replacer");
leave_replacer_select.empty();
leave_replacer_option = ''

leave_replacer_option = leave_replacer_option+'<option value=0>Select Employee Name</option>';
    

{{ replacer_response|safe }}.forEach(item => {

  


    leave_replacer_option= leave_replacer_option+'<option value='+item['id']+'>'+item['name']+'</option>';

})
$('#employee_leave_replacer')

    .find('option')
    .empty()
    .end()
    .append(leave_replacer_option)
    .val(0)
;
$('span#select2-employee_leave_replacer-container').html("Select Employee Name");
$("#startDate").val($(this).attr(''))
$("#endDate").val($(this).attr(''))
var select_absense_status = $('#absence_status');
select_absense_status.empty().append('<option value=Confirmed>Confirmed</option>');
select_absense_status.append('<option value=Planned>Planned</option>');       
$("#employee_alternative_contcat_no").val('')
$("#t1").val('')   
$("#employee_leave_reason").val('')
$("#absence_category").val('')


var select = $('#emp_name');
$("#leave_type_nm").val('')
select.empty().append('<option value=0>Select Leave Type</option>');

        
{{ leave_type_response|safe }}.forEach(item => {

           
                select.append('<option value='+item['id']+'>'+item['name']+'</option>');
            
 

 
})
    })
</script>

<script>
    $(".entitle_balance_validate").click(function(){
       

        employee_id = $("#emp_name_action").val()

        $.ajax({
            url: 'get_employee_validate_entitle_balance',
            // datatype: 'json',
            data: {
                'employee_id': employee_id       
            },
            type: 'GET',
            success: function (data) {  
              
             
            

            $("#entitlement_data1").html(data);

          
                
            }
            
        });


        
    })




</script>



{% endblock %}