{% extends "super_admin/menu.html" %}
{% load ganttchart %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<div class="box_header">
    <div class="row">
        <div class="col-md-7 col-12">
            <div class="mainiconbox"><i class="fa fa-user"></i>
            </div>
            <h4 class="m-t-0 header-title">
                <div class="breadcrumbs ng-scope">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a>Leave Management </a></li>
                        <!-- <li><a>User  Settings</a></li> -->
                    </ul>
                    <div>Leave Gantt</div>
                </div>
            </h4>
        </div>
        <div class="col-md-5 col-12">
            <div class="pull-right p-t-10">
<!-- 
                <a data-toggle="modal" class="btn btn-info newbtn_crete" data-target="#newuser"> <i class="mdi mdi-plus-circle-outline"></i> APPLY NEW LEAVE
                </a> -->
            </div>
        </div>
    </div>
</div>
<div id="gantt_chart1">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    
<div class="card-box ">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    

   <div class="row" style="    padding: 25px 18px;">

    <div class="col-md-2">

        <div class="row">
            <div class="col-md-2">
                <!-- <form action="user_leave_gantt_chart_prev_month_action" method="POST">
                    {% csrf_token %}
                    <input type="hidden" value="{{year}}" name="year">
                    <input type="hidden" value="{{month}}" name="month">
                    <button style="background: #017e84;
                    border: none;
                    padding: 6px 14px;" type="submit" class="btn btn-primary"><i class="fa-solid fa-arrow-left"></i></button>
                  
                </form> -->

                <a data-year="{{year}}" data-month="{{month}}" href="#" class="gantt_chart_prev_month_action">
                    <button style="background: #485978;
                    border: none;
                    padding: 6px 18px;" type="button" class="btn btn-primary "><i class="fa-solid fa-arrow-left"></i></button>
                  
                </a>
            </div>
            <div class="col-md-4">
                <a href="">
                    <button style="background: #485978;
                    border: none;
                    padding: 6px 35px;" type="button" class="btn btn-primary">{{full_month_name}}</button>
                  
                </a>
            
            </div>
            <div class="col-md-2">
                <!-- <form action="user_leave_gantt_chart_next_month_action" method="POST">
                    {% csrf_token %}
                    <input type="hidden" value="{{year}}" name="year">
                    <input type="hidden" value="{{month}}" name="month">

               
                    <button  style="background: #017e84;
                    border: none;
                    padding: 6px 14px;" type="submit" class="btn btn-primary"><i class="fa-solid fa-arrow-right"></i></button>
                  </form> -->

                  <a data-year="{{year}}" data-month="{{month}}" href="#" class="gantt_chart_next_month_action">
                    <button style="background: #485978;
                    border: none;
                    padding: 6px 14px;" type="button" class="btn btn-primary "><i class="fa-solid fa-arrow-right"></i></button>
                  
                </a>
               
            </div>
        </div>
    </div>
   </div>


<script>

    var arr = ['Total',0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
 
</script>
    <table  class="table table-bordered" border="1" >
        <tfoot id="total_leave_count">
            <td >
                <div class="col-md-8" style="       padding: 12px 12px;
                font-weight: bold;  ">
                    <span style="    
                    font-size: 12px;">   Total</span>
                </div>
          
            </td>
            {% for i in "x"|rjust:days %}
            <td style=" text-align: center;  ">
              <span id="c{{forloop.counter}}">
                
              </span>
          
            </td>
         
        
        
            {% endfor %}
          

        </tfoot>
    
    
 <tr>
     <td style="background-color: #485978;    padding: 14px 9px;">
        <span style="    color: white;
        padding: 12px 6px;
        font-weight: bold;"> Name</span>
     </td>
     
     {% for i in "x"|rjust:days %}
     <td style=" text-align: center; background-color: #485978 ;    padding: 14px 9px;">
        
         <span style="    color: white;
         padding: 12px 6px;
        ">  {{forloop.counter}}</span>
     </td>
  
 
 
     {% endfor %}
 
    
     
 
     </tr>


         <script>
             let count = 0 
             let total_user_leave_count1 = 0

             
         </script>

         {% for i in get_chile_response %}



         
         <tr id="myList1{{forloop.counter}}" style="line-height: 6px!important;">
         
         
             <td>
                

              <div class="row">
            
                <div class="col-md-8" style="       padding: 12px 12px;
                font-weight: bold;  ">
                    <span style="    
                    font-size: 12px;    line-height: 13px;"> {{i.name}}</span>
                </div>
               
              </div>
             </td>


             <script>
                 count = 0
                console.log("countfirst:::",count)
             </script>
             {% for i in i.id|get_user_leave_data1:send_data %}



             {% if i.col_before == 0 %}
         
             {% else %}
            
             {% for j in "x"|rjust:i.col_before %}

             <script>

                count = count+1;
                console.log(count)
                total_user_leave_count1 = total_user_leave_count1+1
                

            

               
             </script>
             <td style="   
             color: white;
             padding: 14px;
             font-size: 10px;
             max-width: 61px;
             grid-column: 2/5;
            
             background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255, 255, 255, 0.1) 5px, rgba(255, 255, 255, 0.1) 12px);
             line-height: 13px;">
              
                 
             </td>
         
             {% endfor %}
             {% endif %}
             {% if i.holiday_status_id.1 == "Annual Vacation" %}
             <script>
                total_user_leave_count10 = total_user_leave_count1 + 1
                check_value1 =total_user_leave_count1+ parseInt(`{{i.colspan}}`)
                for(total_user_leave_count10;total_user_leave_count10<=check_value1;total_user_leave_count10++){
            total_user_leave_count1 = total_user_leave_count1+1
           
            arr[total_user_leave_count10] = arr[total_user_leave_count10]+1
            document.getElementById("c"+total_user_leave_count10).innerHTML = arr[total_user_leave_count10];
            
            
        }
               

                count = count+parseInt(`{{i.colspan}}`);
                console.log(count)

            

               
             </script>
             <td style="     background: #f6a096;
             color: white;
             padding: 14px;
             font-size: 10px;
             max-width: 61px;
             grid-column: 2/5;
             background-color: #ffce00;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255, 255, 255, 0.1) 5px, rgba(255, 255, 255, 0.1) 12px);
    line-height: 13px;" colspan="{{i.colspan}}">
                 <center>
                    {{i.holiday_status_id.1}}
                 </center>
                
             </td>
             {% elif i.holiday_status_id.1 == "Unpaid" %}
             <script>
                 total_user_leave_count10 = total_user_leave_count1 + 1
                check_value1 =total_user_leave_count1+ parseInt(`{{i.colspan}}`)
                for(total_user_leave_count10;total_user_leave_count10<=check_value1;total_user_leave_count10++){
            total_user_leave_count1 = total_user_leave_count1+1
           
            arr[total_user_leave_count10] = arr[total_user_leave_count10]+1
            document.getElementById("c"+total_user_leave_count10).innerHTML = arr[total_user_leave_count10];
            
            
        }
               

                count = count+parseInt(`{{i.colspan}}`);
                console.log(count)

            

               
             </script>
             <td style="      background: #f6a096;
             color: white;
             padding: 14px;
             font-size: 10px;
             max-width: 61px;
             grid-column: 2/5;
             background-color: #e30000;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255, 255, 255, 0.1) 5px, rgba(255, 255, 255, 0.1) 12px);
    line-height: 13px;" colspan="{{i.colspan}}">
                 <center>
                    {{i.holiday_status_id.1}}
                 </center>
                
             </td>
             {% elif i.holiday_status_id.1 == "Paid Time Off" %}
             <script>
                 total_user_leave_count10 = total_user_leave_count1 + 1
                check_value1 =total_user_leave_count1+ parseInt(`{{i.colspan}}`)
                for(total_user_leave_count10;total_user_leave_count10<=check_value1;total_user_leave_count10++){
            total_user_leave_count1 = total_user_leave_count1+1
           
            arr[total_user_leave_count10] = arr[total_user_leave_count10]+1
            document.getElementById("c"+total_user_leave_count10).innerHTML = arr[total_user_leave_count10];
            
            
        }
               

                count = count+parseInt(`{{i.colspan}}`);
                console.log(count)

            

               
             </script>
             <td style="       background: #f6a096;
             color: white;
             padding: 14px;
             font-size: 10px;
             max-width: 61px;
             grid-column: 2/5;
    background-color: #00c231;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255, 255, 255, 0.1) 5px, rgba(255, 255, 255, 0.1) 12px);
    line-height: 13px;" colspan="{{i.colspan}}">
                
                    {{i.holiday_status_id.1}}
              
                
             </td>
             
             {% else %}
             <script>
                 total_user_leave_count10 = total_user_leave_count1 + 1
                check_value1 =total_user_leave_count1+ parseInt(`{{i.colspan}}`)
                for(total_user_leave_count10;total_user_leave_count10<=check_value1;total_user_leave_count10++){
            total_user_leave_count1 = total_user_leave_count1+1
           
            arr[total_user_leave_count10] = arr[total_user_leave_count10]+1
            document.getElementById("c"+total_user_leave_count10).innerHTML = arr[total_user_leave_count10];
            
            
        }
               

                count = count+parseInt(`{{i.colspan}}`);
                console.log(count)

            

               
             </script>
             <td style="        background: #f6a096;
             color: white;
             padding: 14px;
             font-size: 10px;
             max-width: 61px;
             grid-column: 2/5;
    background-color: #00a7ff;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255, 255, 255, 0.1) 5px, rgba(255, 255, 255, 0.1) 12px);
    line-height: 13px;" colspan="{{i.colspan}}">
                 <center>
                    {{i.holiday_status_id.1}}
                 </center>
                
             </td>
             {% endif %}
         
             {% endfor %}



             <script>
                console.log("final count:::",count)

                result = `{{days}}`-count

                console.log("resssss:::",result)

                node = "";
                append_list = `{{forloop.counter}}`;


              
                var a = "myList1"+append_list
               
                for (let i = 0; i < result; i++) {

                    $("#"+a).append("<td></td>")
                    console.log("hhhh")


                }
                total_user_leave_count1 = 0
             
              
             </script>

          

             
             </tr>
             {% endfor %}
         


 
         
         <!-- <td style="    background: red;" colspan="2">
         
         <center>
             Leave Type
         </center>
         </td> -->
       </span>
     </tr>

  
    </table>
    </div>

    </div>


    <style>
        .lds-dual-ring.hidden { 
    display: none;
    }
    .lds-dual-ring {
      display: inline-block;
      width: 80px;
      height: 80px;
    }
    .lds-dual-ring:after {
      content: " ";
      display: block;
      width: 64px;
      height: 64px;
      margin: 5% auto;
      border-radius: 50%;
      border: 6px solid #fff;
      border-color: #fff transparent #fff transparent;
      animation: lds-dual-ring 1.2s linear infinite;
    }
    @keyframes lds-dual-ring {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    
    
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0,0,0,.8);
        z-index: 999;
        opacity: 1;
        transition: all 0.5s;
    }
    </style>
         <div id="loader" class="lds-dual-ring hidden overlay"></div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


    <script>
         $(".gantt_chart_next_month_action").click(function(){
             var year = $(this).attr("data-year");
             var month = $(this).attr("data-month")






             $.ajax({
    type: "GET",
    url: "user_leave_gantt_chart_next_month_action",
    data: {
                 'year': year,
                 'month' : month      
             },
    beforeSend: function() {
        $('#loader').removeClass('hidden')
    },
    success: function(data){
        $("#gantt_chart1").html(data);
    },
  complete: function(){
        $('#loader').addClass('hidden')
    },
});

















           
         
         })
     </script>

     <script>

        $(".gantt_chart_prev_month_action").click(function(){
          
            var year = $(this).attr("data-year");
             var month = $(this).attr("data-month")
            





             $.ajax({
                type: "GET",
                url: "user_leave_gantt_chart_prev_month_action",
                data: {
                    'year': year,
                    'month' : month      
                },
                beforeSend: function() {
                    $('#loader').removeClass('hidden')
                },
                success: function(data){
                    $("#gantt_chart1").html(data);
                },
                complete: function(){
                    $('#loader').addClass('hidden')
                },
            });






        })
     </script>
{% endblock %}